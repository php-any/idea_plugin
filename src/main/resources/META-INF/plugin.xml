<idea-plugin>
    <id>com.company.zy-language-plugin</id>
    <name>ZY Language Support</name>
    <vendor email="support@company.com" url="https://company.com">Company</vendor>

    <description><![CDATA[
        ZY Language Support plugin for IntelliJ IDEA.
        Provides syntax highlighting and local Java-based code completion for .zy files.
        
        Features:
        - Syntax highlighting for ZY language files
        - Local Java-based code completion
        - Code navigation and reference resolution
        - Support for .zy file extension
    ]]></description>

    <change-notes><![CDATA[
        <h3>1.0.0</h3>
        <ul>
            <li>Initial release</li>
            <li>Basic syntax highlighting for .zy files</li>
            <li>Local Java-based code completion</li>
            <li>Code navigation and reference resolution</li>
            <li>Support for ZY language file type</li>
        </ul>
    ]]></change-notes>

    <!-- please see https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html
         on how to target different products -->
    <depends>com.intellij.modules.platform</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- 项目服务：符号索引缓存 -->
        <projectService serviceImplementation="com.company.plugin.index.ZySymbolIndexService"/>

        <!-- 启动时创建 .idea/index 目录并预热索引 -->
        <postStartupActivity implementation="com.company.plugin.index.ZyIndexStartup"/>
        <!-- File type registration -->
        <fileType name="ZY File" implementationClass="com.company.plugin.language.ZyFileType" 
                  extensions="zy" 
                  language="ZY" />
        
        <!-- Syntax highlighting -->
        <lang.syntaxHighlighterFactory language="ZY" implementationClass="com.company.plugin.highlighting.ZySyntaxHighlighterFactory" />
        
        <!-- ParserDefinition: 拆分 PSI，避免整文件成为单一元素 -->
        <lang.parserDefinition language="ZY" implementationClass="com.company.plugin.language.ZyParserDefinition"/>
        
        <!-- Code completion -->
        <completion.contributor language="ZY" implementationClass="com.company.plugin.completion.ZyCompletionContributor" />
        
        <!-- Custom navigation action -->
        <action id="ZyNavigationAction" class="com.company.plugin.navigation.ZyNavigationAction" text="ZY Navigation">
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl B"/>
        </action>
        
        <!-- Simple navigation test action -->
        <action id="ZySimpleNavigationAction" class="com.company.plugin.navigation.ZySimpleNavigationAction" text="ZY Navigation Test">
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift N"/>
        </action>
        
        <!-- 移除 LSP 相关扩展，使用本地 Java 实现 -->

        <!-- 已移除的键入与回车处理器不再保留配置 -->
        
        <!-- 跳转到定义处理器 -->
        <gotoDeclarationHandler implementation="com.company.plugin.navigation.ZyGotoDeclarationHandler"/>

        <!-- PSI 引用贡献器：提供标识符级的精确引用范围，控制 Alt 下划线范围 -->
        <psi.referenceContributor implementation="com.company.plugin.navigation.ZyReferenceContributor"/>

        
    </extensions>

    <actions>
        <!-- 手动触发索引重建（主菜单与右键菜单） -->
        <action id="ZyReindexAction" class="com.company.plugin.index.ZyReindexAction" text="ZY: Rebuild Symbol Index">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
        </action>
    </actions>
</idea-plugin>
